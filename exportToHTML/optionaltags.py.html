<html>
<head>
<title>optionaltags.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(204,120,50); }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(106,135,89); }
.s3 { color: rgb(128,128,128); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
optionaltags.py</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import</span><span class="s0">, </span><span class="s1">division</span><span class="s0">, </span><span class="s1">unicode_literals 
 
</span><span class="s0">from </span><span class="s1">. </span><span class="s0">import </span><span class="s1">base 
 
 
</span><span class="s0">class </span><span class="s1">Filter(base.Filter): 
    </span><span class="s0">def </span><span class="s1">slider(self): 
        previous1 = previous2 = </span><span class="s0">None</span><span class="s1"> 
        </span><span class="s0">for </span><span class="s1">token </span><span class="s0">in </span><span class="s1">self.source: 
            </span><span class="s0">if </span><span class="s1">previous1 </span><span class="s0">is not None</span><span class="s1">: 
                </span><span class="s0">yield </span><span class="s1">previous2</span><span class="s0">, </span><span class="s1">previous1</span><span class="s0">, </span><span class="s1">token 
            previous2 = previous1 
            previous1 = token 
        </span><span class="s0">if </span><span class="s1">previous1 </span><span class="s0">is not None</span><span class="s1">: 
            </span><span class="s0">yield </span><span class="s1">previous2</span><span class="s0">, </span><span class="s1">previous1</span><span class="s0">, None</span><span class="s1"> 
 
    </span><span class="s0">def </span><span class="s1">__iter__(self): 
        </span><span class="s0">for </span><span class="s1">previous</span><span class="s0">, </span><span class="s1">token</span><span class="s0">, </span><span class="s1">next </span><span class="s0">in </span><span class="s1">self.slider(): 
            type = token[</span><span class="s2">&quot;type&quot;</span><span class="s1">] 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">if </span><span class="s1">(token[</span><span class="s2">&quot;data&quot;</span><span class="s1">] </span><span class="s0">or</span><span class="s1"> 
                        </span><span class="s0">not </span><span class="s1">self.is_optional_start(token[</span><span class="s2">&quot;name&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">previous</span><span class="s0">, </span><span class="s1">next)): 
                    </span><span class="s0">yield </span><span class="s1">token 
            </span><span class="s0">elif </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot;</span><span class="s1">: 
                </span><span class="s0">if not </span><span class="s1">self.is_optional_end(token[</span><span class="s2">&quot;name&quot;</span><span class="s1">]</span><span class="s0">, </span><span class="s1">next): 
                    </span><span class="s0">yield </span><span class="s1">token 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">yield </span><span class="s1">token 
 
    </span><span class="s0">def </span><span class="s1">is_optional_start(self</span><span class="s0">, </span><span class="s1">tagname</span><span class="s0">, </span><span class="s1">previous</span><span class="s0">, </span><span class="s1">next): 
        type = next </span><span class="s0">and </span><span class="s1">next[</span><span class="s2">&quot;type&quot;</span><span class="s1">] </span><span class="s0">or None</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">tagname </span><span class="s0">in </span><span class="s2">'html'</span><span class="s1">: 
            </span><span class="s3"># An html element's start tag may be omitted if the first thing</span><span class="s1"> 
            </span><span class="s3"># inside the html element is not a space character or a comment.</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s1">type </span><span class="s0">not in </span><span class="s1">(</span><span class="s2">&quot;Comment&quot;</span><span class="s0">, </span><span class="s2">&quot;SpaceCharacters&quot;</span><span class="s1">) 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'head'</span><span class="s1">: 
            </span><span class="s3"># A head element's start tag may be omitted if the first thing</span><span class="s1"> 
            </span><span class="s3"># inside the head element is an element.</span><span class="s1"> 
            </span><span class="s3"># XXX: we also omit the start tag if the head element is empty</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;StartTag&quot;</span><span class="s0">, </span><span class="s2">&quot;EmptyTag&quot;</span><span class="s1">): 
                </span><span class="s0">return True</span><span class="s1"> 
            </span><span class="s0">elif </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] == </span><span class="s2">&quot;head&quot;</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'body'</span><span class="s1">: 
            </span><span class="s3"># A body element's start tag may be omitted if the first thing</span><span class="s1"> 
            </span><span class="s3"># inside the body element is not a space character or a comment,</span><span class="s1"> 
            </span><span class="s3"># except if the first thing inside the body element is a script</span><span class="s1"> 
            </span><span class="s3"># or style element and the node immediately preceding the body</span><span class="s1"> 
            </span><span class="s3"># element is a head element whose end tag has been omitted.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;Comment&quot;</span><span class="s0">, </span><span class="s2">&quot;SpaceCharacters&quot;</span><span class="s1">): 
                </span><span class="s0">return False</span><span class="s1"> 
            </span><span class="s0">elif </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s3"># XXX: we do not look at the preceding event, so we never omit</span><span class="s1"> 
                </span><span class="s3"># the body element's start tag if it's followed by a script or</span><span class="s1"> 
                </span><span class="s3"># a style element.</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] </span><span class="s0">not in </span><span class="s1">(</span><span class="s2">'script'</span><span class="s0">, </span><span class="s2">'style'</span><span class="s1">) 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return True</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'colgroup'</span><span class="s1">: 
            </span><span class="s3"># A colgroup element's start tag may be omitted if the first thing</span><span class="s1"> 
            </span><span class="s3"># inside the colgroup element is a col element, and if the element</span><span class="s1"> 
            </span><span class="s3"># is not immediately preceded by another colgroup element whose</span><span class="s1"> 
            </span><span class="s3"># end tag has been omitted.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;StartTag&quot;</span><span class="s0">, </span><span class="s2">&quot;EmptyTag&quot;</span><span class="s1">): 
                </span><span class="s3"># XXX: we do not look at the preceding event, so instead we never</span><span class="s1"> 
                </span><span class="s3"># omit the colgroup element's end tag when it is immediately</span><span class="s1"> 
                </span><span class="s3"># followed by another colgroup element. See is_optional_end.</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] == </span><span class="s2">&quot;col&quot;</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return False</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'tbody'</span><span class="s1">: 
            </span><span class="s3"># A tbody element's start tag may be omitted if the first thing</span><span class="s1"> 
            </span><span class="s3"># inside the tbody element is a tr element, and if the element is</span><span class="s1"> 
            </span><span class="s3"># not immediately preceded by a tbody, thead, or tfoot element</span><span class="s1"> 
            </span><span class="s3"># whose end tag has been omitted.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s3"># omit the thead and tfoot elements' end tag when they are</span><span class="s1"> 
                </span><span class="s3"># immediately followed by a tbody element. See is_optional_end.</span><span class="s1"> 
                </span><span class="s0">if </span><span class="s1">previous </span><span class="s0">and </span><span class="s1">previous[</span><span class="s2">'type'</span><span class="s1">] == </span><span class="s2">'EndTag' </span><span class="s0">and </span><span class="s1">\ 
                        previous[</span><span class="s2">'name'</span><span class="s1">] </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'tbody'</span><span class="s0">, </span><span class="s2">'thead'</span><span class="s0">, </span><span class="s2">'tfoot'</span><span class="s1">): 
                    </span><span class="s0">return False</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] == </span><span class="s2">'tr'</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return False</span><span class="s1"> 
        </span><span class="s0">return False</span><span class="s1"> 
 
    </span><span class="s0">def </span><span class="s1">is_optional_end(self</span><span class="s0">, </span><span class="s1">tagname</span><span class="s0">, </span><span class="s1">next): 
        type = next </span><span class="s0">and </span><span class="s1">next[</span><span class="s2">&quot;type&quot;</span><span class="s1">] </span><span class="s0">or None</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">tagname </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'html'</span><span class="s0">, </span><span class="s2">'head'</span><span class="s0">, </span><span class="s2">'body'</span><span class="s1">): 
            </span><span class="s3"># An html element's end tag may be omitted if the html element</span><span class="s1"> 
            </span><span class="s3"># is not immediately followed by a space character or a comment.</span><span class="s1"> 
            </span><span class="s0">return </span><span class="s1">type </span><span class="s0">not in </span><span class="s1">(</span><span class="s2">&quot;Comment&quot;</span><span class="s0">, </span><span class="s2">&quot;SpaceCharacters&quot;</span><span class="s1">) 
        </span><span class="s0">elif </span><span class="s1">tagname </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'li'</span><span class="s0">, </span><span class="s2">'optgroup'</span><span class="s0">, </span><span class="s2">'tr'</span><span class="s1">): 
            </span><span class="s3"># A li element's end tag may be omitted if the li element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by another li element or if there is</span><span class="s1"> 
            </span><span class="s3"># no more content in the parent element.</span><span class="s1"> 
            </span><span class="s3"># An optgroup element's end tag may be omitted if the optgroup</span><span class="s1"> 
            </span><span class="s3"># element is immediately followed by another optgroup element,</span><span class="s1"> 
            </span><span class="s3"># or if there is no more content in the parent element.</span><span class="s1"> 
            </span><span class="s3"># A tr element's end tag may be omitted if the tr element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by another tr element, or if there is</span><span class="s1"> 
            </span><span class="s3"># no more content in the parent element.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] == tagname 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'dt'</span><span class="s0">, </span><span class="s2">'dd'</span><span class="s1">): 
            </span><span class="s3"># A dt element's end tag may be omitted if the dt element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by another dt element or a dd element.</span><span class="s1"> 
            </span><span class="s3"># A dd element's end tag may be omitted if the dd element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by another dd element or a dt element,</span><span class="s1"> 
            </span><span class="s3"># or if there is no more content in the parent element.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'dt'</span><span class="s0">, </span><span class="s2">'dd'</span><span class="s1">) 
            </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'dd'</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return False</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'p'</span><span class="s1">: 
            </span><span class="s3"># A p element's end tag may be omitted if the p element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by an address, article, aside,</span><span class="s1"> 
            </span><span class="s3"># blockquote, datagrid, dialog, dir, div, dl, fieldset,</span><span class="s1"> 
            </span><span class="s3"># footer, form, h1, h2, h3, h4, h5, h6, header, hr, menu,</span><span class="s1"> 
            </span><span class="s3"># nav, ol, p, pre, section, table, or ul, element, or if</span><span class="s1"> 
            </span><span class="s3"># there is no more content in the parent element.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;StartTag&quot;</span><span class="s0">, </span><span class="s2">&quot;EmptyTag&quot;</span><span class="s1">): 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'address'</span><span class="s0">, </span><span class="s2">'article'</span><span class="s0">, </span><span class="s2">'aside'</span><span class="s0">,</span><span class="s1"> 
                                        </span><span class="s2">'blockquote'</span><span class="s0">, </span><span class="s2">'datagrid'</span><span class="s0">, </span><span class="s2">'dialog'</span><span class="s0">,</span><span class="s1"> 
                                        </span><span class="s2">'dir'</span><span class="s0">, </span><span class="s2">'div'</span><span class="s0">, </span><span class="s2">'dl'</span><span class="s0">, </span><span class="s2">'fieldset'</span><span class="s0">, </span><span class="s2">'footer'</span><span class="s0">,</span><span class="s1"> 
                                        </span><span class="s2">'form'</span><span class="s0">, </span><span class="s2">'h1'</span><span class="s0">, </span><span class="s2">'h2'</span><span class="s0">, </span><span class="s2">'h3'</span><span class="s0">, </span><span class="s2">'h4'</span><span class="s0">, </span><span class="s2">'h5'</span><span class="s0">, </span><span class="s2">'h6'</span><span class="s0">,</span><span class="s1"> 
                                        </span><span class="s2">'header'</span><span class="s0">, </span><span class="s2">'hr'</span><span class="s0">, </span><span class="s2">'menu'</span><span class="s0">, </span><span class="s2">'nav'</span><span class="s0">, </span><span class="s2">'ol'</span><span class="s0">,</span><span class="s1"> 
                                        </span><span class="s2">'p'</span><span class="s0">, </span><span class="s2">'pre'</span><span class="s0">, </span><span class="s2">'section'</span><span class="s0">, </span><span class="s2">'table'</span><span class="s0">, </span><span class="s2">'ul'</span><span class="s1">) 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'option'</span><span class="s1">: 
            </span><span class="s3"># An option element's end tag may be omitted if the option</span><span class="s1"> 
            </span><span class="s3"># element is immediately followed by another option element,</span><span class="s1"> 
            </span><span class="s3"># or if it is immediately followed by an &lt;code&gt;optgroup&lt;/code&gt;</span><span class="s1"> 
            </span><span class="s3"># element, or if there is no more content in the parent</span><span class="s1"> 
            </span><span class="s3"># element.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'option'</span><span class="s0">, </span><span class="s2">'optgroup'</span><span class="s1">) 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'rt'</span><span class="s0">, </span><span class="s2">'rp'</span><span class="s1">): 
            </span><span class="s3"># An rt element's end tag may be omitted if the rt element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by an rt or rp element, or if there is</span><span class="s1"> 
            </span><span class="s3"># no more content in the parent element.</span><span class="s1"> 
            </span><span class="s3"># An rp element's end tag may be omitted if the rp element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by an rt or rp element, or if there is</span><span class="s1"> 
            </span><span class="s3"># no more content in the parent element.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'rt'</span><span class="s0">, </span><span class="s2">'rp'</span><span class="s1">) 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'colgroup'</span><span class="s1">: 
            </span><span class="s3"># A colgroup element's end tag may be omitted if the colgroup</span><span class="s1"> 
            </span><span class="s3"># element is not immediately followed by a space character or</span><span class="s1"> 
            </span><span class="s3"># a comment.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type </span><span class="s0">in </span><span class="s1">(</span><span class="s2">&quot;Comment&quot;</span><span class="s0">, </span><span class="s2">&quot;SpaceCharacters&quot;</span><span class="s1">): 
                </span><span class="s0">return False</span><span class="s1"> 
            </span><span class="s0">elif </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s3"># XXX: we also look for an immediately following colgroup</span><span class="s1"> 
                </span><span class="s3"># element. See is_optional_start.</span><span class="s1"> 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] != </span><span class="s2">'colgroup'</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return True</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'thead'</span><span class="s0">, </span><span class="s2">'tbody'</span><span class="s1">): 
            </span><span class="s3"># A thead element's end tag may be omitted if the thead element</span><span class="s1"> 
            </span><span class="s3"># is immediately followed by a tbody or tfoot element.</span><span class="s1"> 
            </span><span class="s3"># A tbody element's end tag may be omitted if the tbody element</span><span class="s1"> 
            </span><span class="s3"># is immediately followed by a tbody or tfoot element, or if</span><span class="s1"> 
            </span><span class="s3"># there is no more content in the parent element.</span><span class="s1"> 
            </span><span class="s3"># A tfoot element's end tag may be omitted if the tfoot element</span><span class="s1"> 
            </span><span class="s3"># is immediately followed by a tbody element, or if there is no</span><span class="s1"> 
            </span><span class="s3"># more content in the parent element.</span><span class="s1"> 
            </span><span class="s3"># XXX: we never omit the end tag when the following element is</span><span class="s1"> 
            </span><span class="s3"># a tbody. See is_optional_start.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] </span><span class="s0">in </span><span class="s1">[</span><span class="s2">'tbody'</span><span class="s0">, </span><span class="s2">'tfoot'</span><span class="s1">] 
            </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'tbody'</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return False</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname == </span><span class="s2">'tfoot'</span><span class="s1">: 
            </span><span class="s3"># A tfoot element's end tag may be omitted if the tfoot element</span><span class="s1"> 
            </span><span class="s3"># is immediately followed by a tbody element, or if there is no</span><span class="s1"> 
            </span><span class="s3"># more content in the parent element.</span><span class="s1"> 
            </span><span class="s3"># XXX: we never omit the end tag when the following element is</span><span class="s1"> 
            </span><span class="s3"># a tbody. See is_optional_start.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] == </span><span class="s2">'tbody'</span><span class="s1"> 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
        </span><span class="s0">elif </span><span class="s1">tagname </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'td'</span><span class="s0">, </span><span class="s2">'th'</span><span class="s1">): 
            </span><span class="s3"># A td element's end tag may be omitted if the td element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by a td or th element, or if there is</span><span class="s1"> 
            </span><span class="s3"># no more content in the parent element.</span><span class="s1"> 
            </span><span class="s3"># A th element's end tag may be omitted if the th element is</span><span class="s1"> 
            </span><span class="s3"># immediately followed by a td or th element, or if there is</span><span class="s1"> 
            </span><span class="s3"># no more content in the parent element.</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">type == </span><span class="s2">&quot;StartTag&quot;</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">next[</span><span class="s2">&quot;name&quot;</span><span class="s1">] </span><span class="s0">in </span><span class="s1">(</span><span class="s2">'td'</span><span class="s0">, </span><span class="s2">'th'</span><span class="s1">) 
            </span><span class="s0">else</span><span class="s1">: 
                </span><span class="s0">return </span><span class="s1">type == </span><span class="s2">&quot;EndTag&quot; </span><span class="s0">or </span><span class="s1">type </span><span class="s0">is None</span><span class="s1"> 
        </span><span class="s0">return False</span><span class="s1"> 
</span></pre>
</body>
</html>