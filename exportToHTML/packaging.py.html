<html>
<head>
<title>packaging.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(204,120,50); }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(98,151,85); font-style: italic; }
.s3 { color: rgb(128,128,128); }
.s4 { color: rgb(106,135,89); }
.s5 { color: rgb(104,151,187); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
packaging.py</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import 
 
</span><span class="s0">from </span><span class="s1">email.parser </span><span class="s0">import </span><span class="s1">FeedParser 
 
</span><span class="s0">import </span><span class="s1">logging 
</span><span class="s0">import </span><span class="s1">sys 
 
</span><span class="s0">from </span><span class="s1">pip._vendor.packaging </span><span class="s0">import </span><span class="s1">specifiers 
</span><span class="s0">from </span><span class="s1">pip._vendor.packaging </span><span class="s0">import </span><span class="s1">version 
</span><span class="s0">from </span><span class="s1">pip._vendor </span><span class="s0">import </span><span class="s1">pkg_resources 
 
</span><span class="s0">from </span><span class="s1">pip </span><span class="s0">import </span><span class="s1">exceptions 
 
logger = logging.getLogger(__name__) 
 
 
</span><span class="s0">def </span><span class="s1">check_requires_python(requires_python): 
    </span><span class="s2">&quot;&quot;&quot; 
    Check if the python version in use match the `requires_python` specifier. 
 
    Returns `True` if the version of python in use matches the requirement. 
    Returns `False` if the version of python in use does not matches the 
    requirement. 
 
    Raises an InvalidSpecifier if `requires_python` have an invalid format. 
    &quot;&quot;&quot;</span><span class="s1"> 
    </span><span class="s0">if </span><span class="s1">requires_python </span><span class="s0">is None</span><span class="s1">: 
        </span><span class="s3"># The package provides no information</span><span class="s1"> 
        </span><span class="s0">return True</span><span class="s1"> 
    requires_python_specifier = specifiers.SpecifierSet(requires_python) 
 
    </span><span class="s3"># We only use major.minor.micro</span><span class="s1"> 
    python_version = version.parse(</span><span class="s4">'.'</span><span class="s1">.join(map(str</span><span class="s0">, </span><span class="s1">sys.version_info[:</span><span class="s5">3</span><span class="s1">]))) 
    </span><span class="s0">return </span><span class="s1">python_version </span><span class="s0">in </span><span class="s1">requires_python_specifier 
 
 
</span><span class="s0">def </span><span class="s1">get_metadata(dist): 
    </span><span class="s0">if </span><span class="s1">(isinstance(dist</span><span class="s0">, </span><span class="s1">pkg_resources.DistInfoDistribution) </span><span class="s0">and</span><span class="s1"> 
            dist.has_metadata(</span><span class="s4">'METADATA'</span><span class="s1">)): 
        </span><span class="s0">return </span><span class="s1">dist.get_metadata(</span><span class="s4">'METADATA'</span><span class="s1">) 
    </span><span class="s0">elif </span><span class="s1">dist.has_metadata(</span><span class="s4">'PKG-INFO'</span><span class="s1">): 
        </span><span class="s0">return </span><span class="s1">dist.get_metadata(</span><span class="s4">'PKG-INFO'</span><span class="s1">) 
 
 
</span><span class="s0">def </span><span class="s1">check_dist_requires_python(dist): 
    metadata = get_metadata(dist) 
    feed_parser = FeedParser() 
    feed_parser.feed(metadata) 
    pkg_info_dict = feed_parser.close() 
    requires_python = pkg_info_dict.get(</span><span class="s4">'Requires-Python'</span><span class="s1">) 
    </span><span class="s0">try</span><span class="s1">: 
        </span><span class="s0">if not </span><span class="s1">check_requires_python(requires_python): 
            </span><span class="s0">raise </span><span class="s1">exceptions.UnsupportedPythonVersion( 
                </span><span class="s4">&quot;%s requires Python '%s' but the running Python is %s&quot; </span><span class="s1">% ( 
                    dist.project_name</span><span class="s0">,</span><span class="s1"> 
                    requires_python</span><span class="s0">,</span><span class="s1"> 
                    </span><span class="s4">'.'</span><span class="s1">.join(map(str</span><span class="s0">, </span><span class="s1">sys.version_info[:</span><span class="s5">3</span><span class="s1">]))</span><span class="s0">,</span><span class="s1">) 
            ) 
    </span><span class="s0">except </span><span class="s1">specifiers.InvalidSpecifier </span><span class="s0">as </span><span class="s1">e: 
        logger.warning( 
            </span><span class="s4">&quot;Package %s has an invalid Requires-Python entry %s - %s&quot; </span><span class="s1">% ( 
                dist.project_name</span><span class="s0">, </span><span class="s1">requires_python</span><span class="s0">, </span><span class="s1">e)) 
        </span><span class="s0">return</span><span class="s1"> 
</span></pre>
</body>
</html>