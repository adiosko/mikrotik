<html>
<head>
<title>locations.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(98,151,85); font-style: italic; }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(204,120,50); }
.s3 { color: rgb(128,128,128); }
.s4 { color: rgb(106,135,89); }
.s5 { color: rgb(104,151,187); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
locations.py</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">&quot;&quot;&quot;Locations where we look for configs, install stuff, etc&quot;&quot;&quot;</span><span class="s1"> 
</span><span class="s2">from </span><span class="s1">__future__ </span><span class="s2">import </span><span class="s1">absolute_import 
 
</span><span class="s2">import </span><span class="s1">os 
</span><span class="s2">import </span><span class="s1">os.path 
</span><span class="s2">import </span><span class="s1">site 
</span><span class="s2">import </span><span class="s1">sys 
 
</span><span class="s2">from </span><span class="s1">distutils </span><span class="s2">import </span><span class="s1">sysconfig 
</span><span class="s2">from </span><span class="s1">distutils.command.install </span><span class="s2">import </span><span class="s1">install</span><span class="s2">, </span><span class="s1">SCHEME_KEYS  </span><span class="s3"># noqa</span><span class="s1"> 
 
</span><span class="s2">from </span><span class="s1">pip.compat </span><span class="s2">import </span><span class="s1">WINDOWS</span><span class="s2">, </span><span class="s1">expanduser 
</span><span class="s2">from </span><span class="s1">pip.utils </span><span class="s2">import </span><span class="s1">appdirs 
 
 
</span><span class="s3"># Application Directories</span><span class="s1"> 
USER_CACHE_DIR = appdirs.user_cache_dir(</span><span class="s4">&quot;pip&quot;</span><span class="s1">) 
 
 
DELETE_MARKER_MESSAGE = </span><span class="s4">'''</span><span class="s2">\ 
</span><span class="s4">This file is placed here by pip to indicate the source was put 
here by pip. 
 
Once this package is successfully installed this source code will be 
deleted (unless you remove this file). 
'''</span><span class="s1"> 
PIP_DELETE_MARKER_FILENAME = </span><span class="s4">'pip-delete-this-directory.txt'</span><span class="s1"> 
 
 
</span><span class="s2">def </span><span class="s1">write_delete_marker_file(directory): 
    </span><span class="s0">&quot;&quot;&quot; 
    Write the pip delete marker file into this directory. 
    &quot;&quot;&quot;</span><span class="s1"> 
    filepath = os.path.join(directory</span><span class="s2">, </span><span class="s1">PIP_DELETE_MARKER_FILENAME) 
    </span><span class="s2">with </span><span class="s1">open(filepath</span><span class="s2">, </span><span class="s4">'w'</span><span class="s1">) </span><span class="s2">as </span><span class="s1">marker_fp: 
        marker_fp.write(DELETE_MARKER_MESSAGE) 
 
 
</span><span class="s2">def </span><span class="s1">running_under_virtualenv(): 
    </span><span class="s0">&quot;&quot;&quot; 
    Return True if we're running inside a virtualenv, False otherwise. 
 
    &quot;&quot;&quot;</span><span class="s1"> 
    </span><span class="s2">if </span><span class="s1">hasattr(sys</span><span class="s2">, </span><span class="s4">'real_prefix'</span><span class="s1">): 
        </span><span class="s2">return True</span><span class="s1"> 
    </span><span class="s2">elif </span><span class="s1">sys.prefix != getattr(sys</span><span class="s2">, </span><span class="s4">&quot;base_prefix&quot;</span><span class="s2">, </span><span class="s1">sys.prefix): 
        </span><span class="s2">return True</span><span class="s1"> 
 
    </span><span class="s2">return False</span><span class="s1"> 
 
 
</span><span class="s2">def </span><span class="s1">virtualenv_no_global(): 
    </span><span class="s0">&quot;&quot;&quot; 
    Return True if in a venv and no system site packages. 
    &quot;&quot;&quot;</span><span class="s1"> 
    </span><span class="s3"># this mirrors the logic in virtualenv.py for locating the</span><span class="s1"> 
    </span><span class="s3"># no-global-site-packages.txt file</span><span class="s1"> 
    site_mod_dir = os.path.dirname(os.path.abspath(site.__file__)) 
    no_global_file = os.path.join(site_mod_dir</span><span class="s2">, </span><span class="s4">'no-global-site-packages.txt'</span><span class="s1">) 
    </span><span class="s2">if </span><span class="s1">running_under_virtualenv() </span><span class="s2">and </span><span class="s1">os.path.isfile(no_global_file): 
        </span><span class="s2">return True</span><span class="s1"> 
 
 
</span><span class="s2">if </span><span class="s1">running_under_virtualenv(): 
    src_prefix = os.path.join(sys.prefix</span><span class="s2">, </span><span class="s4">'src'</span><span class="s1">) 
</span><span class="s2">else</span><span class="s1">: 
    </span><span class="s3"># FIXME: keep src in cwd for now (it is not a temporary folder)</span><span class="s1"> 
    </span><span class="s2">try</span><span class="s1">: 
        src_prefix = os.path.join(os.getcwd()</span><span class="s2">, </span><span class="s4">'src'</span><span class="s1">) 
    </span><span class="s2">except </span><span class="s1">OSError: 
        </span><span class="s3"># In case the current working directory has been renamed or deleted</span><span class="s1"> 
        sys.exit( 
            </span><span class="s4">&quot;The folder you are executing pip from can no longer be found.&quot;</span><span class="s1"> 
        ) 
 
</span><span class="s3"># under macOS + virtualenv sys.prefix is not properly resolved</span><span class="s1"> 
</span><span class="s3"># it is something like /path/to/python/bin/..</span><span class="s1"> 
</span><span class="s3"># Note: using realpath due to tmp dirs on OSX being symlinks</span><span class="s1"> 
src_prefix = os.path.abspath(src_prefix) 
 
</span><span class="s3"># FIXME doesn't account for venv linked to global site-packages</span><span class="s1"> 
 
site_packages = sysconfig.get_python_lib() 
user_site = site.USER_SITE 
user_dir = expanduser(</span><span class="s4">'~'</span><span class="s1">) 
</span><span class="s2">if </span><span class="s1">WINDOWS: 
    bin_py = os.path.join(sys.prefix</span><span class="s2">, </span><span class="s4">'Scripts'</span><span class="s1">) 
    bin_user = os.path.join(user_site</span><span class="s2">, </span><span class="s4">'Scripts'</span><span class="s1">) 
    </span><span class="s3"># buildout uses 'bin' on Windows too?</span><span class="s1"> 
    </span><span class="s2">if not </span><span class="s1">os.path.exists(bin_py): 
        bin_py = os.path.join(sys.prefix</span><span class="s2">, </span><span class="s4">'bin'</span><span class="s1">) 
        bin_user = os.path.join(user_site</span><span class="s2">, </span><span class="s4">'bin'</span><span class="s1">) 
 
    config_basename = </span><span class="s4">'pip.ini'</span><span class="s1"> 
 
    legacy_storage_dir = os.path.join(user_dir</span><span class="s2">, </span><span class="s4">'pip'</span><span class="s1">) 
    legacy_config_file = os.path.join( 
        legacy_storage_dir</span><span class="s2">,</span><span class="s1"> 
        config_basename</span><span class="s2">,</span><span class="s1"> 
    ) 
</span><span class="s2">else</span><span class="s1">: 
    bin_py = os.path.join(sys.prefix</span><span class="s2">, </span><span class="s4">'bin'</span><span class="s1">) 
    bin_user = os.path.join(user_site</span><span class="s2">, </span><span class="s4">'bin'</span><span class="s1">) 
 
    config_basename = </span><span class="s4">'pip.conf'</span><span class="s1"> 
 
    legacy_storage_dir = os.path.join(user_dir</span><span class="s2">, </span><span class="s4">'.pip'</span><span class="s1">) 
    legacy_config_file = os.path.join( 
        legacy_storage_dir</span><span class="s2">,</span><span class="s1"> 
        config_basename</span><span class="s2">,</span><span class="s1"> 
    ) 
 
    </span><span class="s3"># Forcing to use /usr/local/bin for standard macOS framework installs</span><span class="s1"> 
    </span><span class="s3"># Also log to ~/Library/Logs/ for use with the Console.app log viewer</span><span class="s1"> 
    </span><span class="s2">if </span><span class="s1">sys.platform[:</span><span class="s5">6</span><span class="s1">] == </span><span class="s4">'darwin' </span><span class="s2">and </span><span class="s1">sys.prefix[:</span><span class="s5">16</span><span class="s1">] == </span><span class="s4">'/System/Library/'</span><span class="s1">: 
        bin_py = </span><span class="s4">'/usr/local/bin'</span><span class="s1"> 
 
site_config_files = [ 
    os.path.join(path</span><span class="s2">, </span><span class="s1">config_basename) 
    </span><span class="s2">for </span><span class="s1">path </span><span class="s2">in </span><span class="s1">appdirs.site_config_dirs(</span><span class="s4">'pip'</span><span class="s1">) 
] 
 
 
</span><span class="s2">def </span><span class="s1">distutils_scheme(dist_name</span><span class="s2">, </span><span class="s1">user=</span><span class="s2">False, </span><span class="s1">home=</span><span class="s2">None, </span><span class="s1">root=</span><span class="s2">None,</span><span class="s1"> 
                     isolated=</span><span class="s2">False, </span><span class="s1">prefix=</span><span class="s2">None</span><span class="s1">): 
    </span><span class="s0">&quot;&quot;&quot; 
    Return a distutils install scheme 
    &quot;&quot;&quot;</span><span class="s1"> 
    </span><span class="s2">from </span><span class="s1">distutils.dist </span><span class="s2">import </span><span class="s1">Distribution 
 
    scheme = {} 
 
    </span><span class="s2">if </span><span class="s1">isolated: 
        extra_dist_args = {</span><span class="s4">&quot;script_args&quot;</span><span class="s1">: [</span><span class="s4">&quot;--no-user-cfg&quot;</span><span class="s1">]} 
    </span><span class="s2">else</span><span class="s1">: 
        extra_dist_args = {} 
    dist_args = {</span><span class="s4">'name'</span><span class="s1">: dist_name} 
    dist_args.update(extra_dist_args) 
 
    d = Distribution(dist_args) 
    d.parse_config_files() 
    i = d.get_command_obj(</span><span class="s4">'install'</span><span class="s2">, </span><span class="s1">create=</span><span class="s2">True</span><span class="s1">) 
    </span><span class="s3"># NOTE: setting user or home has the side-effect of creating the home dir</span><span class="s1"> 
    </span><span class="s3"># or user base for installations during finalize_options()</span><span class="s1"> 
    </span><span class="s3"># ideally, we'd prefer a scheme class that has no side-effects.</span><span class="s1"> 
    </span><span class="s2">assert not </span><span class="s1">(user </span><span class="s2">and </span><span class="s1">prefix)</span><span class="s2">, </span><span class="s4">&quot;user={0} prefix={1}&quot;</span><span class="s1">.format(user</span><span class="s2">, </span><span class="s1">prefix) 
    i.user = user </span><span class="s2">or </span><span class="s1">i.user 
    </span><span class="s2">if </span><span class="s1">user: 
        i.prefix = </span><span class="s4">&quot;&quot;</span><span class="s1"> 
    i.prefix = prefix </span><span class="s2">or </span><span class="s1">i.prefix 
    i.home = home </span><span class="s2">or </span><span class="s1">i.home 
    i.root = root </span><span class="s2">or </span><span class="s1">i.root 
    i.finalize_options() 
    </span><span class="s2">for </span><span class="s1">key </span><span class="s2">in </span><span class="s1">SCHEME_KEYS: 
        scheme[key] = getattr(i</span><span class="s2">, </span><span class="s4">'install_' </span><span class="s1">+ key) 
 
    </span><span class="s3"># install_lib specified in setup.cfg should install *everything*</span><span class="s1"> 
    </span><span class="s3"># into there (i.e. it takes precedence over both purelib and</span><span class="s1"> 
    </span><span class="s3"># platlib).  Note, i.install_lib is *always* set after</span><span class="s1"> 
    </span><span class="s3"># finalize_options(); we only want to override here if the user</span><span class="s1"> 
    </span><span class="s3"># has explicitly requested it hence going back to the config</span><span class="s1"> 
    </span><span class="s2">if </span><span class="s4">'install_lib' </span><span class="s2">in </span><span class="s1">d.get_option_dict(</span><span class="s4">'install'</span><span class="s1">): 
        scheme.update(dict(purelib=i.install_lib</span><span class="s2">, </span><span class="s1">platlib=i.install_lib)) 
 
    </span><span class="s2">if </span><span class="s1">running_under_virtualenv(): 
        scheme[</span><span class="s4">'headers'</span><span class="s1">] = os.path.join( 
            sys.prefix</span><span class="s2">,</span><span class="s1"> 
            </span><span class="s4">'include'</span><span class="s2">,</span><span class="s1"> 
            </span><span class="s4">'site'</span><span class="s2">,</span><span class="s1"> 
            </span><span class="s4">'python' </span><span class="s1">+ sys.version[:</span><span class="s5">3</span><span class="s1">]</span><span class="s2">,</span><span class="s1"> 
            dist_name</span><span class="s2">,</span><span class="s1"> 
        ) 
 
        </span><span class="s2">if </span><span class="s1">root </span><span class="s2">is not None</span><span class="s1">: 
            path_no_drive = os.path.splitdrive( 
                os.path.abspath(scheme[</span><span class="s4">&quot;headers&quot;</span><span class="s1">]))[</span><span class="s5">1</span><span class="s1">] 
            scheme[</span><span class="s4">&quot;headers&quot;</span><span class="s1">] = os.path.join( 
                root</span><span class="s2">,</span><span class="s1"> 
                path_no_drive[</span><span class="s5">1</span><span class="s1">:]</span><span class="s2">,</span><span class="s1"> 
            ) 
 
    </span><span class="s2">return </span><span class="s1">scheme 
</span></pre>
</body>
</html>