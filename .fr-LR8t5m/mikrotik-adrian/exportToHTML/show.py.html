<html>
<head>
<title>show.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<style type="text/css">
.ln { color: #606366; font-weight: normal; font-style: normal; }
.s0 { color: rgb(204,120,50); }
.s1 { color: rgb(169,183,198); }
.s2 { color: rgb(98,151,85); font-style: italic; }
.s3 { color: rgb(106,135,89); }
.s4 { color: rgb(104,151,187); }
.s5 { color: rgb(128,128,128); }
</style>
</head>
<BODY BGCOLOR="#2b2b2b">
<TABLE CELLSPACING=0 CELLPADDING=5 COLS=1 WIDTH="100%" BGCOLOR="#606060" >
<TR><TD><CENTER>
<FONT FACE="Arial, Helvetica" COLOR="#000000">
show.py</FONT>
</center></TD></TR></TABLE>
<pre>
<span class="s0">from </span><span class="s1">__future__ </span><span class="s0">import </span><span class="s1">absolute_import 
 
</span><span class="s0">from </span><span class="s1">email.parser </span><span class="s0">import </span><span class="s1">FeedParser 
</span><span class="s0">import </span><span class="s1">logging 
</span><span class="s0">import </span><span class="s1">os 
 
</span><span class="s0">from </span><span class="s1">pip.basecommand </span><span class="s0">import </span><span class="s1">Command 
</span><span class="s0">from </span><span class="s1">pip.status_codes </span><span class="s0">import </span><span class="s1">SUCCESS</span><span class="s0">, </span><span class="s1">ERROR 
</span><span class="s0">from </span><span class="s1">pip._vendor </span><span class="s0">import </span><span class="s1">pkg_resources 
</span><span class="s0">from </span><span class="s1">pip._vendor.packaging.utils </span><span class="s0">import </span><span class="s1">canonicalize_name 
 
 
logger = logging.getLogger(__name__) 
 
 
</span><span class="s0">class </span><span class="s1">ShowCommand(Command): 
    </span><span class="s2">&quot;&quot;&quot;Show information about one or more installed packages.&quot;&quot;&quot;</span><span class="s1"> 
    name = </span><span class="s3">'show'</span><span class="s1"> 
    usage = </span><span class="s3">&quot;&quot;&quot; 
      %prog [options] &lt;package&gt; ...&quot;&quot;&quot;</span><span class="s1"> 
    summary = </span><span class="s3">'Show information about installed packages.'</span><span class="s1"> 
 
    </span><span class="s0">def </span><span class="s1">__init__(self</span><span class="s0">, </span><span class="s1">*args</span><span class="s0">, </span><span class="s1">**kw): 
        super(ShowCommand</span><span class="s0">, </span><span class="s1">self).__init__(*args</span><span class="s0">, </span><span class="s1">**kw) 
        self.cmd_opts.add_option( 
            </span><span class="s3">'-f'</span><span class="s0">, </span><span class="s3">'--files'</span><span class="s0">,</span><span class="s1"> 
            dest=</span><span class="s3">'files'</span><span class="s0">,</span><span class="s1"> 
            action=</span><span class="s3">'store_true'</span><span class="s0">,</span><span class="s1"> 
            default=</span><span class="s0">False,</span><span class="s1"> 
            help=</span><span class="s3">'Show the full list of installed files for each package.'</span><span class="s1">) 
 
        self.parser.insert_option_group(</span><span class="s4">0</span><span class="s0">, </span><span class="s1">self.cmd_opts) 
 
    </span><span class="s0">def </span><span class="s1">run(self</span><span class="s0">, </span><span class="s1">options</span><span class="s0">, </span><span class="s1">args): 
        </span><span class="s0">if not </span><span class="s1">args: 
            logger.warning(</span><span class="s3">'ERROR: Please provide a package name or names.'</span><span class="s1">) 
            </span><span class="s0">return </span><span class="s1">ERROR 
        query = args 
 
        results = search_packages_info(query) 
        </span><span class="s0">if not </span><span class="s1">print_results( 
                results</span><span class="s0">, </span><span class="s1">list_files=options.files</span><span class="s0">, </span><span class="s1">verbose=options.verbose): 
            </span><span class="s0">return </span><span class="s1">ERROR 
        </span><span class="s0">return </span><span class="s1">SUCCESS 
 
 
</span><span class="s0">def </span><span class="s1">search_packages_info(query): 
    </span><span class="s2">&quot;&quot;&quot; 
    Gather details from installed distributions. Print distribution name, 
    version, location, and installed files. Installed files requires a 
    pip generated 'installed-files.txt' in the distributions '.egg-info' 
    directory. 
    &quot;&quot;&quot;</span><span class="s1"> 
    installed = {} 
    </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">pkg_resources.working_set: 
        installed[canonicalize_name(p.project_name)] = p 
 
    query_names = [canonicalize_name(name) </span><span class="s0">for </span><span class="s1">name </span><span class="s0">in </span><span class="s1">query] 
 
    </span><span class="s0">for </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">[installed[pkg] </span><span class="s0">for </span><span class="s1">pkg </span><span class="s0">in </span><span class="s1">query_names </span><span class="s0">if </span><span class="s1">pkg </span><span class="s0">in </span><span class="s1">installed]: 
        package = { 
            </span><span class="s3">'name'</span><span class="s1">: dist.project_name</span><span class="s0">,</span><span class="s1"> 
            </span><span class="s3">'version'</span><span class="s1">: dist.version</span><span class="s0">,</span><span class="s1"> 
            </span><span class="s3">'location'</span><span class="s1">: dist.location</span><span class="s0">,</span><span class="s1"> 
            </span><span class="s3">'requires'</span><span class="s1">: [dep.project_name </span><span class="s0">for </span><span class="s1">dep </span><span class="s0">in </span><span class="s1">dist.requires()]</span><span class="s0">,</span><span class="s1"> 
        } 
        file_list = </span><span class="s0">None</span><span class="s1"> 
        metadata = </span><span class="s0">None</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">isinstance(dist</span><span class="s0">, </span><span class="s1">pkg_resources.DistInfoDistribution): 
            </span><span class="s5"># RECORDs should be part of .dist-info metadatas</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">dist.has_metadata(</span><span class="s3">'RECORD'</span><span class="s1">): 
                lines = dist.get_metadata_lines(</span><span class="s3">'RECORD'</span><span class="s1">) 
                paths = [l.split(</span><span class="s3">','</span><span class="s1">)[</span><span class="s4">0</span><span class="s1">] </span><span class="s0">for </span><span class="s1">l </span><span class="s0">in </span><span class="s1">lines] 
                paths = [os.path.join(dist.location</span><span class="s0">, </span><span class="s1">p) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">paths] 
                file_list = [os.path.relpath(p</span><span class="s0">, </span><span class="s1">dist.location) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">paths] 
 
            </span><span class="s0">if </span><span class="s1">dist.has_metadata(</span><span class="s3">'METADATA'</span><span class="s1">): 
                metadata = dist.get_metadata(</span><span class="s3">'METADATA'</span><span class="s1">) 
        </span><span class="s0">else</span><span class="s1">: 
            </span><span class="s5"># Otherwise use pip's log for .egg-info's</span><span class="s1"> 
            </span><span class="s0">if </span><span class="s1">dist.has_metadata(</span><span class="s3">'installed-files.txt'</span><span class="s1">): 
                paths = dist.get_metadata_lines(</span><span class="s3">'installed-files.txt'</span><span class="s1">) 
                paths = [os.path.join(dist.egg_info</span><span class="s0">, </span><span class="s1">p) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">paths] 
                file_list = [os.path.relpath(p</span><span class="s0">, </span><span class="s1">dist.location) </span><span class="s0">for </span><span class="s1">p </span><span class="s0">in </span><span class="s1">paths] 
 
            </span><span class="s0">if </span><span class="s1">dist.has_metadata(</span><span class="s3">'PKG-INFO'</span><span class="s1">): 
                metadata = dist.get_metadata(</span><span class="s3">'PKG-INFO'</span><span class="s1">) 
 
        </span><span class="s0">if </span><span class="s1">dist.has_metadata(</span><span class="s3">'entry_points.txt'</span><span class="s1">): 
            entry_points = dist.get_metadata_lines(</span><span class="s3">'entry_points.txt'</span><span class="s1">) 
            package[</span><span class="s3">'entry_points'</span><span class="s1">] = entry_points 
 
        </span><span class="s0">if </span><span class="s1">dist.has_metadata(</span><span class="s3">'INSTALLER'</span><span class="s1">): 
            </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">dist.get_metadata_lines(</span><span class="s3">'INSTALLER'</span><span class="s1">): 
                </span><span class="s0">if </span><span class="s1">line.strip(): 
                    package[</span><span class="s3">'installer'</span><span class="s1">] = line.strip() 
                    </span><span class="s0">break</span><span class="s1"> 
 
        </span><span class="s5"># @todo: Should pkg_resources.Distribution have a</span><span class="s1"> 
        </span><span class="s5"># `get_pkg_info` method?</span><span class="s1"> 
        feed_parser = FeedParser() 
        feed_parser.feed(metadata) 
        pkg_info_dict = feed_parser.close() 
        </span><span class="s0">for </span><span class="s1">key </span><span class="s0">in </span><span class="s1">(</span><span class="s3">'metadata-version'</span><span class="s0">, </span><span class="s3">'summary'</span><span class="s0">,</span><span class="s1"> 
                    </span><span class="s3">'home-page'</span><span class="s0">, </span><span class="s3">'author'</span><span class="s0">, </span><span class="s3">'author-email'</span><span class="s0">, </span><span class="s3">'license'</span><span class="s1">): 
            package[key] = pkg_info_dict.get(key) 
 
        </span><span class="s5"># It looks like FeedParser cannot deal with repeated headers</span><span class="s1"> 
        classifiers = [] 
        </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">metadata.splitlines(): 
            </span><span class="s0">if </span><span class="s1">line.startswith(</span><span class="s3">'Classifier: '</span><span class="s1">): 
                classifiers.append(line[len(</span><span class="s3">'Classifier: '</span><span class="s1">):]) 
        package[</span><span class="s3">'classifiers'</span><span class="s1">] = classifiers 
 
        </span><span class="s0">if </span><span class="s1">file_list: 
            package[</span><span class="s3">'files'</span><span class="s1">] = sorted(file_list) 
        </span><span class="s0">yield </span><span class="s1">package 
 
 
</span><span class="s0">def </span><span class="s1">print_results(distributions</span><span class="s0">, </span><span class="s1">list_files=</span><span class="s0">False, </span><span class="s1">verbose=</span><span class="s0">False</span><span class="s1">): 
    </span><span class="s2">&quot;&quot;&quot; 
    Print the informations from installed distributions found. 
    &quot;&quot;&quot;</span><span class="s1"> 
    results_printed = </span><span class="s0">False</span><span class="s1"> 
    </span><span class="s0">for </span><span class="s1">i</span><span class="s0">, </span><span class="s1">dist </span><span class="s0">in </span><span class="s1">enumerate(distributions): 
        results_printed = </span><span class="s0">True</span><span class="s1"> 
        </span><span class="s0">if </span><span class="s1">i &gt; </span><span class="s4">0</span><span class="s1">: 
            logger.info(</span><span class="s3">&quot;---&quot;</span><span class="s1">) 
        logger.info(</span><span class="s3">&quot;Name: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'name'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;Version: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'version'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;Summary: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'summary'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;Home-page: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'home-page'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;Author: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'author'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;Author-email: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'author-email'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;License: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'license'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;Location: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'location'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
        logger.info(</span><span class="s3">&quot;Requires: %s&quot;</span><span class="s0">, </span><span class="s3">', '</span><span class="s1">.join(dist.get(</span><span class="s3">'requires'</span><span class="s0">, </span><span class="s1">[]))) 
        </span><span class="s0">if </span><span class="s1">verbose: 
            logger.info(</span><span class="s3">&quot;Metadata-Version: %s&quot;</span><span class="s0">,</span><span class="s1"> 
                        dist.get(</span><span class="s3">'metadata-version'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
            logger.info(</span><span class="s3">&quot;Installer: %s&quot;</span><span class="s0">, </span><span class="s1">dist.get(</span><span class="s3">'installer'</span><span class="s0">, </span><span class="s3">''</span><span class="s1">)) 
            logger.info(</span><span class="s3">&quot;Classifiers:&quot;</span><span class="s1">) 
            </span><span class="s0">for </span><span class="s1">classifier </span><span class="s0">in </span><span class="s1">dist.get(</span><span class="s3">'classifiers'</span><span class="s0">, </span><span class="s1">[]): 
                logger.info(</span><span class="s3">&quot;  %s&quot;</span><span class="s0">, </span><span class="s1">classifier) 
            logger.info(</span><span class="s3">&quot;Entry-points:&quot;</span><span class="s1">) 
            </span><span class="s0">for </span><span class="s1">entry </span><span class="s0">in </span><span class="s1">dist.get(</span><span class="s3">'entry_points'</span><span class="s0">, </span><span class="s1">[]): 
                logger.info(</span><span class="s3">&quot;  %s&quot;</span><span class="s0">, </span><span class="s1">entry.strip()) 
        </span><span class="s0">if </span><span class="s1">list_files: 
            logger.info(</span><span class="s3">&quot;Files:&quot;</span><span class="s1">) 
            </span><span class="s0">for </span><span class="s1">line </span><span class="s0">in </span><span class="s1">dist.get(</span><span class="s3">'files'</span><span class="s0">, </span><span class="s1">[]): 
                logger.info(</span><span class="s3">&quot;  %s&quot;</span><span class="s0">, </span><span class="s1">line.strip()) 
            </span><span class="s0">if </span><span class="s3">&quot;files&quot; </span><span class="s0">not in </span><span class="s1">dist: 
                logger.info(</span><span class="s3">&quot;Cannot locate installed-files.txt&quot;</span><span class="s1">) 
    </span><span class="s0">return </span><span class="s1">results_printed 
</span></pre>
</body>
</html>